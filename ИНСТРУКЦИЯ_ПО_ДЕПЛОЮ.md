# Инструкция по деплою исправлений путей

## Что было исправлено?

Приложение искало файлы в неправильных местах:
- ❌ Искало: `/var/www/resultMA/python/omr_color.py`
- ✅ Теперь: `/var/www/resultMA/server/python/omr_color.py`

## Быстрый деплой

### Вариант 1: Автоматический скрипт (рекомендуется)

```bash
bash deploy-path-fix.sh
```

### Вариант 2: Ручной деплой

```bash
# 1. Перейти в директорию сервера
cd /var/www/resultMA/server

# 2. Установить зависимости (если нужно)
npm install

# 3. Скомпилировать TypeScript
npm run build

# 4. Вернуться в корень проекта
cd /var/www/resultMA

# 5. Перезапустить PM2
pm2 restart all

# 6. Проверить логи
pm2 logs
```

## Проверка после деплоя

В логах PM2 должны появиться правильные пути:

```
✅ Python script path: /var/www/resultMA/server/python/omr_color.py
✅ Upload directory ready: /var/www/resultMA/server/uploads/omr
✅ QR scanner script: /var/www/resultMA/server/python/qr_scanner.py
```

## Тестирование

1. Откройте приложение в браузере
2. Перейдите в раздел проверки OMR
3. Загрузите тестовое изображение ответного листа
4. Проверьте что:
   - Изображение загружается без ошибок
   - QR-код распознается
   - Ответы определяются корректно
   - Обработанное изображение сохраняется

## Если что-то пошло не так

### Ошибка компиляции TypeScript

```bash
cd /var/www/resultMA/server
npm install
npm run build
```

### Python скрипты не найдены

Проверьте что файлы существуют:
```bash
ls -la /var/www/resultMA/server/python/
```

Должны быть:
- `omr_color.py`
- `qr_scanner.py`

### Директория uploads не создается

Создайте вручную:
```bash
mkdir -p /var/www/resultMA/server/uploads/omr
chmod 755 /var/www/resultMA/server/uploads/omr
```

### PM2 не перезапускается

```bash
pm2 list
pm2 restart all
pm2 logs --lines 50
```

## Откат изменений (если нужно)

Если что-то пошло не так, можно откатить изменения через git:

```bash
cd /var/www/resultMA
git status
git diff
git checkout server/src/
npm run build
pm2 restart all
```

## Дополнительная информация

Подробное описание всех изменений смотрите в файле `PATH_FIX_SUMMARY.md`
